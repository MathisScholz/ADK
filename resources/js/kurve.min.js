/**
 * @license
 *
 * Program:     Kurve
 * Author:      Markus Mächler, marmaechler@gmail.com
 * License:     http://www.gnu.org/licenses/gpl.txt
 * Link:        http://achtungkurve.com
 *
 * Copyright © 2014, 2015 Markus Mächler
 *
 * Kurve is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Kurve is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Kurve.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
"use strict";window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;"use strict";var Kurve={players:[],playersById:{},init:function(){this.initPlayers(),this.Field.init(),this.Menu.init(),this.Game.init(),this.Lightbox.init()},initPlayers:function(){Kurve.Config.players.forEach(function(e){var e=new Kurve.Player(e.id,e.color,e.keyLeft,e.keyRight,e.keySuperpower);Kurve.players.push(e),Kurve.playersById[e.getId()]=e})},getPlayer:function(e){return this.playersById[e]},reload:function(){location.reload()},onUnload:function(){Kurve.Piwik.trackPageView()}};document.addEventListener("DOMContentLoaded",Kurve.init.bind(Kurve));"use strict";Kurve.Factory={getSuperpower:function(e){if(!Kurve.Superpowerconfig.hasOwnProperty(e))throw"Superpower type "+e+" is not yet registered.";var r=Kurve.Superpowerconfig[e].hooks,o=Kurve.Superpowerconfig[e].act,p=Kurve.Superpowerconfig[e].helpers,u=Kurve.Superpowerconfig[e].init,t=Kurve.Superpowerconfig[e].close;return new Kurve.Superpower(r,o,p,e,u,t)}};"use strict";Kurve.Config={Debug:{curvePosition:!1,curveTrace:!1,fieldDrawnPixels:!1},Field:{defaultColor:"#333",defaultLineWidth:4,borderColor:"#ACAC9D",width:.7},Curve:{stepLength:2.7,lineWidth:4,dAngle:.07,holeInterval:200,selfCollisionTimeout:150},Game:{startDelay:2e3,fps:30},Utility:{interpolatedPixelsPrecision:100},players:[{id:"red",color:"#D4373E",keyLeft:49,keyRight:81,keySuperpower:65},{id:"orange",color:"#FFA039",keyLeft:37,keyRight:40,keySuperpower:39},{id:"green",color:"#3BCB69",keyLeft:89,keyRight:88,keySuperpower:67},{id:"blue",color:"#3B90C3",keyLeft:66,keyRight:78,keySuperpower:77},{id:"purple",color:"#7D11CD",keyLeft:76,keyRight:79,keySuperpower:80},{id:"pink",color:"#DC72FF",keyLeft:53,keyRight:54,keySuperpower:55}]};"use strict";Kurve.Utility=function(t){return t instanceof String,new Kurve.Utility.Element(t)},Kurve.Utility.Element=function(t){this.element=t},Kurve.Utility.round=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},Kurve.Utility.addClass=function(t,e){var n=document.getElementById(e);return null===n?!1:void(n.className+=" "+t)},Kurve.Utility.removeClass=function(t,e){var n=document.getElementById(e);if(null===n)return!1;var r=new RegExp("(^|\\s)"+t+"($|\\s)","g");n.className=n.className.replace(r," ")},Kurve.Utility.setClassName=function(t,e){var n=document.getElementById(e);return null===n?!1:void(n.className=t)},Kurve.Utility.hasClass=function(t,e){var n=document.getElementById(e);if(null===n)return!1;var r=new RegExp("(^|\\s)"+t+"($|\\s)","g");return r.test(n.className)},Kurve.Utility.interpolateTwoPoints=function(t,e,n,r){for(var i=[],l=Kurve.Config.Utility.interpolatedPixelsPrecision,a=n-t,o=(r-e)/a,s=r-o*n,v=u.round(Math.abs(a)*l,0),d=1>v?1:v,c=0;d>c;c++){var m=a>0?c/l:-(c/l),y=t+m,f=o*y+s,K=u.round(y,0),U=u.round(f,0);void 0===i[K]&&(i[K]=[]),i[K][U]!==!0&&(i[K][U]=!0)}return i},Kurve.Utility.addPointToArray=function(t,e,n){var r=u.round(e,0);void 0===t[r]&&(t[r]=[]),t[r][u.round(n,0)]=!0};var u=Kurve.Utility;"use strict";Kurve.Menu={boundOnKeyDown:null,init:function(){this.initPlayerMenu(),this.addWindowListeners(),this.addMouseListeners()},initPlayerMenu:function(){var e="";Kurve.players.forEach(function(r){e+=r.renderMenuItem()}),document.getElementById("menu-players-list").innerHTML+=e},addWindowListeners:function(){this.boundOnKeyDown=this.onKeyDown.bind(this),window.addEventListener("keydown",this.boundOnKeyDown,!1)},addMouseListeners:function(){for(var e=document.getElementById("menu-players-list").children,r=0;r<e.length;r++)e[r].addEventListener("click",this.onPlayerItemClicked,!1)},removeWindowListeners:function(){window.removeEventListener("keydown",this.boundOnKeyDown,!1)},onPlayerItemClicked:function(e){Kurve.Menu.togglePlayerActivation(this.id)},onKeyDown:function(e){32===e.keyCode&&Kurve.Menu.onSpaceDown(),Kurve.players.forEach(function(r){r.isKeyLeft(e.keyCode)?Kurve.Menu.activatePlayer(r.getId()):r.isKeyRight(e.keyCode)?Kurve.Menu.deactivatePlayer(r.getId()):r.isKeySuperpower(e.keyCode)&&Kurve.Menu.nextSuperpower(r.getId())})},onSpaceDown:function(){return Kurve.players.forEach(function(e){e.isActive()&&Kurve.Game.curves.push(new Kurve.Curve(e,Kurve.Game,Kurve.Field,Kurve.Config.Curve))}),Kurve.Game.curves.length<=1?void(Kurve.Game.curves=[]):(u.addClass("hidden","layer-menu"),u.removeClass("hidden","layer-game"),void Kurve.Game.startGame())},onNextSuperPowerClicked:function(e,r){e.stopPropagation(),Kurve.Menu.nextSuperpower(r)},onPreviousSuperPowerClicked:function(e,r){e.stopPropagation(),Kurve.Menu.previousSuperpower(r)},nextSuperpower:function(e){var r=Kurve.getPlayer(e),t=0,n="";for(var u in Kurve.Superpowerconfig.types)if(t++,Kurve.Superpowerconfig.types[u]===r.getSuperpower().getType()){n=Object.keys(Kurve.Superpowerconfig.types).length===t?Object.keys(Kurve.Superpowerconfig.types)[0]:Object.keys(Kurve.Superpowerconfig.types)[t];break}r.setSuperpower(Kurve.Factory.getSuperpower(n))},previousSuperpower:function(e){var r=Kurve.getPlayer(e),t=0,n="";for(var u in Kurve.Superpowerconfig.types)if(t++,Kurve.Superpowerconfig.types[u]===r.getSuperpower().getType()){n=1===t?Object.keys(Kurve.Superpowerconfig.types)[Object.keys(Kurve.Superpowerconfig.types).length-1]:Object.keys(Kurve.Superpowerconfig.types)[t-2];break}r.setSuperpower(Kurve.Factory.getSuperpower(n))},activatePlayer:function(e){Kurve.getPlayer(e).isActive()||(Kurve.getPlayer(e).setIsActive(!0),u.removeClass("inactive",e),u.addClass("active",e))},deactivatePlayer:function(e){Kurve.getPlayer(e).isActive()&&(Kurve.getPlayer(e).setIsActive(!1),u.removeClass("active",e),u.addClass("inactive",e))},togglePlayerActivation:function(e){Kurve.getPlayer(e).isActive()?Kurve.Menu.deactivatePlayer(e):Kurve.Menu.activatePlayer(e)},requestFullScreen:function(){document.body.webkitRequestFullScreen()}};"use strict";Kurve.Game={runIntervalId:null,fps:null,intervalTimeOut:null,maxPoints:null,keysDown:{},isRunning:!1,curves:[],runningCurves:{},players:[],deathMatch:!1,isPaused:!1,isRoundStarted:!1,playerScoresElement:null,isGameOver:!1,init:function(){this.fps=Kurve.Config.Game.fps,this.intervalTimeOut=Math.round(1e3/this.fps),this.playerScoresElement=document.getElementById("player-scores")},run:function(){requestAnimationFrame(this.drawFrame.bind(this))},drawFrame:function(){for(var e in this.runningCurves)void 0!==this.runningCurves[e]&&this.runningCurves[e].drawNextFrame()},addWindowListeners:function(){Kurve.Menu.removeWindowListeners(),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))},onKeyDown:function(e){32===e.keyCode&&this.onSpaceDown(),this.keysDown[e.keyCode]=!0},onKeyUp:function(e){delete this.keysDown[e.keyCode]},isKeyDown:function(e){return this.keysDown[e]===!0},onSpaceDown:function(){return this.isGameOver?location.reload():this.isRunning||this.isPaused?this.togglePause():this.isRoundStarted||this.deathMatch?!this.isRoundStarted&&this.deathMatch?this.startDeathMatch():void 0:this.startNewRound()},togglePause:function(){this.isPaused?(Kurve.Lightbox.hide(),this.startRun()):(this.stopRun(),Kurve.Lightbox.show("<h2>Game is paused</h2>")),this.isPaused=!this.isPaused},startGame:function(){this.maxPoints=10*(this.curves.length-1),this.addPlayers(),this.addWindowListeners(),this.renderPlayerScores(),Kurve.Piwik.trackPageVariable("number_of_players",this.players.length),this.startNewRound.bind(this)},renderPlayerScores:function(){var e="";this.players.sort(this.playerSorting),this.players.forEach(function(t){e+=t.renderScoreItem()}),this.playerScoresElement.innerHTML=e},playerSorting:function(e,t){return t.getPoints()-e.getPoints()},addPlayers:function(){Kurve.Game.curves.forEach(function(e){Kurve.Game.players.push(e.getPlayer())})},notifyDeath:function(e){delete this.runningCurves[e.getPlayer().getId()];for(var t in this.runningCurves)this.runningCurves[t].getPlayer().incrementPoints();this.renderPlayerScores(),1===Object.keys(this.runningCurves).length&&this.terminateRound()},startNewRound:function(){this.isRoundStarted=!0,Kurve.Field.drawField(),this.initRun(),this.renderPlayerScores(),setTimeout(this.startRun.bind(this),Kurve.Config.Game.startDelay)},startRun:function(){this.isRunning=!0,this.runIntervalId=setInterval(this.run.bind(this),this.intervalTimeOut),this.curves.forEach(function(e){e.setJustStarted(!0)})},stopRun:function(){this.isRunning=!1,clearInterval(this.runIntervalId)},initRun:function(){this.curves.forEach(function(e){Kurve.Game.runningCurves[e.getPlayer().getId()]=e,e.setRandomPosition(Kurve.Field.getRandomPosition().getPosX(),Kurve.Field.getRandomPosition().getPosY()),e.setRandomAngle(),e.drawCurrentPosition(Kurve.Field),e.getPlayer().getSuperpower().init(e)})},terminateRound:function(){if(this.curves.forEach(function(e){e.getPlayer().getSuperpower().close(e)}),this.deathMatch){var e=this.runningCurves[Object.keys(this.runningCurves)[0]];this.gameOver(e.getPlayer())}this.isRoundStarted=!1,this.stopRun(),this.runningCurves={},this.incrementSuperpowers(),this.checkForWinner()},incrementSuperpowers:function(){var e=this.players.length;this.players[e-1].getSuperpower().incrementCount(),this.players[e-1].getSuperpower().incrementCount();for(var t=u.round((e-2)/2,0),n=t;n>0;n--)this.players[e-1-n].getSuperpower().incrementCount()},checkForWinner:function(){if(!this.deathMatch){var e=[];this.players.forEach(function(t){t.getPoints()>=Kurve.Game.maxPoints&&e.push(t)}),0!==e.length&&(1===e.length&&this.gameOver(e[0]),e.length>1&&this.initDeathMatch(e))}},initDeathMatch:function(e){this.deathMatch=!0,Kurve.Lightbox.show('<div class="deathmatch"><h1>DEATHMATCH!</h1></div>');var t=[];this.curves.forEach(function(n){e.forEach(function(e){n.getPlayer()===e&&(t.push(n),e.setColor("#333"))})}),this.curves=t},startDeathMatch:function(e){Kurve.Lightbox.hide(),this.startNewRound()},gameOver:function(e){Kurve.Piwik.trackPageVariable("finished_game","yes"),this.isGameOver=!0,Kurve.Lightbox.show('<h1 class="active '+e.getId()+'">'+e.getId()+' wins!</h1><a href="#" onclick="Kurve.reload(); return false;" title="Go back to the menu"  class="button">Start new game</a>')}};"use strict";Kurve.Field={canvas:null,ctx:null,width:null,height:null,drawnPixels:[],defaultColor:null,defaultLineWidth:null,drawnPixelPrecision:null,init:function(){this.initCanvas(),this.initContext(),this.initDrawing(),this.initField()},initCanvas:function(){var i=window.innerWidth*Kurve.Config.Field.width,t=window.innerHeight;this.canvas=document.getElementById("field"),this.canvas.width=i,this.canvas.height=t,this.width=i,this.height=t},initContext:function(){this.ctx=this.canvas.getContext("2d")},initField:function(){this.drawField()},initDrawing:function(){this.defaultColor=Kurve.Config.Field.defaultColor,this.defaultLineWidth=Kurve.Config.Field.defaultLineWidth,this.drawnPixelPrecision=Kurve.Config.Field.drawnPixelPrecision},drawField:function(){this.ctx.beginPath(),this.ctx.strokeStyle=Kurve.Config.Field.borderColor,this.ctx.lineWidth=3,this.ctx.clearRect(0,0,this.width,this.height),this.ctx.rect(0,0,this.width,this.height),this.ctx.stroke(),this.drawnPixels=[]},drawLine:function(i,t,n,o,r){void 0===r&&(r=this.defaultColor),this.ctx.beginPath(),this.ctx.strokeStyle=r,this.ctx.lineWidth=this.defaultLineWidth,this.ctx.moveTo(i,t),this.ctx.lineTo(n,o),this.ctx.stroke(),this.addLineToDrawnPixel(i,t,n,o,r)},drawUntrackedPoint:function(i,t,n){void 0===n&&(n=this.defaultColor),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(i,t,2,0,2*Math.PI,!1),this.ctx.fill()},drawPoint:function(i,t,n){this.drawUntrackedPoint(i,t,n),this.addPointToDrawnPixel(i,t,n)},addLineToDrawnPixel:function(i,t,n,o,r){var d=u.interpolateTwoPoints(i,t,n,o);for(var e in d)for(var a in d[e])this.addPointsToDrawnPixel(this.getPointSurroundings(e,a),r)},addPointsToDrawnPixel:function(i,t){for(var n in i)for(var o in i[n])this.addPointToDrawnPixel(n,o,t)},addPointToDrawnPixel:function(i,t,n){var o=u.round(i,0),r=u.round(t,0);void 0===this.drawnPixels[o]&&(this.drawnPixels[o]=[]),this.drawnPixels[o][r]={color:n,time:new Date},Kurve.Config.Debug.fieldDrawnPixels&&(this.ctx.fillStyle="#37FDFC",this.ctx.fillRect(o,r,1,1))},isPointOutOfBounds:function(i,t){return 0>=i||0>=t||i>=this.width||t>=this.height},isPointDrawn:function(i,t){return void 0!==this.drawnPixels[u.round(i,0)]&&void 0!==this.drawnPixels[u.round(i,0)][u.round(t,0)]},isPointDrawnInColor:function(i,t,n){return void 0!==this.drawnPixels[u.round(i,0)]&&this.drawnPixels[u.round(i,0)][u.round(t,0)].color===n},getDrawnPoint:function(i,t){var n=u.round(i,0),o=u.round(t,0);return void 0!==this.drawnPixels[n]&&void 0!==this.drawnPixels[n][o]?this.drawnPixels[n][o]:!1},getRandomPosition:function(i){void 0===i&&(i=20);var t=i+Math.round((this.width-2*i)*Math.random()),n=i+Math.round((this.height-2*i)*Math.random());return new Kurve.Point(t,n)},getPointSurroundings:function(i,t){var n=u.round(i,0),o=u.round(t,0),r=[];return u.addPointToArray(r,n,o),u.addPointToArray(r,n+1,o),u.addPointToArray(r,n+1,o-1),u.addPointToArray(r,n,o-1),u.addPointToArray(r,n-1,o-1),u.addPointToArray(r,n-1,o),u.addPointToArray(r,n-1,o+1),u.addPointToArray(r,n,o+1),u.addPointToArray(r,n+1,o+1),r}};"use strict";Kurve.Superpowerconfig={},Kurve.Superpowerconfig.types={RUN_FASTER:"RUN_FASTER",RUN_SLOWER:"RUN_SLOWER",JUMP:"JUMP",INVISIBLE:"INVISIBLE",VERTICAL_BAR:"VERTICAL_BAR",CROSS_WALLS:"CROSS_WALLS",DARK_KNIGHT:"DARK_KNIGHT"},Kurve.Superpowerconfig.hooks={DRAW_NEXT_FRAME:"DRAW_NEXT_FRAME",DRAW_LINE:"DRAW_LINE",IS_COLLIDED:"IS_COLLIDED"},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.RUN_FASTER]={label:"run faster",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{executionTime:0,initAct:function(){this.decrementCount(),this.setIsActive(!0),this.helpers.executionTime=4*Kurve.Game.fps},closeAct:function(){this.setIsActive(!1)}},init:function(e){},act:function(e,t){this.isActive()||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),t.moveToNextFrame(),t.checkForCollision(),t.drawLine(t.getField()),this.helpers.executionTime--},close:function(e){this.setIsActive(!1)}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.RUN_SLOWER]={label:"run slower",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{initialStepLength:null,executionTime:0,initAct:function(e){this.decrementCount(),this.setIsActive(!0),this.helpers.executionTime=4*Kurve.Game.fps,this.helpers.initialStepLength=e.getOptions().stepLength,e.getOptions().stepLength=this.helpers.initialStepLength/2},closeAct:function(e){this.setIsActive(!1),e.getOptions().stepLength=this.helpers.initialStepLength}},init:function(e){},act:function(e,t){this.isActive()||this.helpers.initAct.call(this,t),this.helpers.executionTime<1&&this.helpers.closeAct.call(this,t),this.helpers.executionTime--},close:function(e){this.setIsActive(!1),null!==this.helpers.initialStepLength&&(e.getOptions().stepLength=this.helpers.initialStepLength)}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.JUMP]={label:"jump",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{jumpWidth:10,timeOut:250,previousExecution:new Date},init:function(e){},act:function(e,t){var i=new Date;if(i.getTime()-this.helpers.previousExecution.getTime()>this.helpers.timeOut){var s=t.getMovedPositionX(t.getOptions().stepLength*this.helpers.jumpWidth),o=t.getMovedPositionY(t.getOptions().stepLength*this.helpers.jumpWidth);t.setNextPositionX(s),t.setNextPositionY(o),t.setPreviousMiddlePointX(s),t.setPreviousMiddlePointY(o),this.helpers.previousExecution=i,this.decrementCount()}},close:function(e){}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.INVISIBLE]={label:"invisible",hooks:[Kurve.Superpowerconfig.hooks.DRAW_LINE,Kurve.Superpowerconfig.hooks.IS_COLLIDED],helpers:{executionTime:0,initAct:function(){this.decrementCount(),this.setIsActive(!0),this.helpers.executionTime=4*Kurve.Game.fps},closeAct:function(){this.setIsActive(!1)}},init:function(e){},act:function(e,t){if(e===Kurve.Superpowerconfig.hooks.DRAW_LINE)this.isActive()||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),t.setIsInvisible(!0),this.helpers.executionTime--;else if(e===Kurve.Superpowerconfig.hooks.IS_COLLIDED&&this.isActive())return!1},close:function(e){this.setIsActive(!1)}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.VERTICAL_BAR]={label:"vertical bar",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{timeOut:250,previousExecution:new Date,barWidth:40},init:function(e){},act:function(e,t){var i=new Date;if(i.getTime()-this.helpers.previousExecution.getTime()>this.helpers.timeOut){var s=Math.cos(t.getOptions().angle-Math.PI/2)*this.helpers.barWidth+t.getPositionX(),o=Math.sin(t.getOptions().angle-Math.PI/2)*this.helpers.barWidth+t.getPositionY(),n=Math.cos(t.getOptions().angle+Math.PI/2)*this.helpers.barWidth+t.getPositionX(),r=Math.sin(t.getOptions().angle+Math.PI/2)*this.helpers.barWidth+t.getPositionY();Kurve.Field.drawLine(s,o,n,r,t.getPlayer().getColor()),this.helpers.previousExecution=i,this.decrementCount()}},close:function(e){}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.CROSS_WALLS]={label:"cross walls",hooks:[Kurve.Superpowerconfig.hooks.IS_COLLIDED],helpers:{getWallCrossedPosition:function(e){var t,i=e.getNextPositionX(),s=e.getNextPositionY(),o=e.getField(),n=0;return i>o.width?(t=i-o.width,n=s):0>i?(t=i+o.width,n=s):s>o.height?(t=i,n=s-o.height):(t=i,n=s+o.height),new Kurve.Point(t,n)}},init:function(e){this.setIsActive(!0)},act:function(e,t){var i=t.getNextPositionX(),s=t.getNextPositionY();if(t.getField().isPointOutOfBounds(i,s)&&this.getCount()>0){this.decrementCount();var o=this.helpers.getWallCrossedPosition(t);return t.setPositionX(o.getPosX()),t.setPositionY(o.getPosY()),t.setNextPositionX(o.getPosX()),t.setNextPositionY(o.getPosY()),t.setPreviousMiddlePointX(o.getPosX()),t.setPreviousMiddlePointY(o.getPosY()),t.setPreviousMiddlePositionX(o.getPosX()),t.setPreviousMiddlePositionY(o.getPosY()),!1}return null},close:function(e){this.setIsActive(!1)}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.DARK_KNIGHT]={label:"dark knight",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{executionTime:0,darkNightDivId:"dark-knight",initAct:function(){u.hasClass("hidden",this.helpers.darkNightDivId)&&(u.removeClass("hidden",this.helpers.darkNightDivId),this.decrementCount(),this.setIsActive(!0),this.helpers.executionTime=3*Kurve.Game.fps)},closeAct:function(){u.addClass("hidden",this.helpers.darkNightDivId),this.setIsActive(!1)}},init:function(e){},act:function(e,t){this.isActive()||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),this.helpers.executionTime--},close:function(e){this.setIsActive(!1),u.hasClass("hidden",this.helpers.darkNightDivId)||u.addClass("hidden",this.helpers.darkNightDivId)}};"use strict";Kurve.Superpower=function(e,t,r,n,i,o){var u=1,s=!1;this.act=t,this.helpers=r,this.init=i,this.close=o,this.incrementCount=function(){u++,Kurve.Game.renderPlayerScores()},this.decrementCount=function(){u--,Kurve.Game.renderPlayerScores()},this.getHooks=function(){return e},this.getType=function(){return n},this.getCount=function(){return u},this.isActive=function(){return s},this.setIsActive=function(e){s=e}},Kurve.Superpower.prototype.getLabel=function(){return Kurve.Superpowerconfig[this.getType()].label},Kurve.Superpower.prototype.usesHook=function(e){return this.getHooks().indexOf(e)>-1};"use strict";Kurve.Curve=function(t,e,i,o,n){var s=!1,r=!1,u=null,h=null,l=null,g=null,P=null,d=null,p=null,v=null,c={stepLength:o.stepLength,lineWidth:o.lineWidth,angle:0,dAngle:o.dAngle,holeInterval:o.holeInterval,holeCountDown:o.holeInterval,selfCollisionTimeout:o.selfCollisionTimeout};this.setRandomPosition=function(t,e){h=g=v=d=t,u=l=p=P=e},this.incrementAngle=function(){c.angle+=c.dAngle},this.decrementAngle=function(){c.angle-=c.dAngle},this.setPositionY=function(t){u=t},this.setPositionX=function(t){h=t},this.setNextPositionY=function(t){l=t},this.setNextPositionX=function(t){g=t},this.setAngle=function(t){c.angle=t},this.setJustStarted=function(t){s=t},this.setIsInvisible=function(t){r=t},this.setPreviousMiddlePointY=function(t){P=t},this.setPreviousMiddlePointX=function(t){d=t},this.setPreviousMiddlePositionY=function(t){p=t},this.setPreviousMiddlePositionX=function(t){v=t},this.hasJustStarted=function(){return s},this.getPlayer=function(){return t},this.getGame=function(){return e},this.getField=function(){return i},this.getSuperpower=function(){return n},this.getPositionY=function(){return u},this.getPositionX=function(){return h},this.getNextPositionY=function(){return l},this.getNextPositionX=function(){return g},this.getOptions=function(){return c},this.isInvisible=function(){return r},this.getPreviousMiddlePointY=function(){return P},this.getPreviousMiddlePointX=function(){return d},this.getPreviousMiddlePositionY=function(){return p},this.getPreviousMiddlePositionX=function(){return v}},Kurve.Curve.prototype.drawNextFrame=function(){this.moveToNextFrame(),this.checkForCollision(),this.drawLine(this.getField()),this.useSuperpower(Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME)&&this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME,this),Kurve.Config.Debug.curvePosition&&(this.getField().ctx.fillStyle="#000",this.getField().ctx.fillRect(u.round(this.getPositionX(),0),u.round(this.getPositionY(),0),1,1))},Kurve.Curve.prototype.drawCurrentPosition=function(t){t.drawUntrackedPoint(this.getPositionX(),this.getPositionY(),this.getPlayer().getColor())},Kurve.Curve.prototype.drawLine=function(t){this.setIsInvisible(this.getOptions().holeCountDown<0),this.useSuperpower(Kurve.Superpowerconfig.hooks.DRAW_LINE)&&this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.DRAW_LINE,this),this.isInvisible()?this.getOptions().holeCountDown<-2&&this.resetHoleCountDown():t.drawLine(this.getPreviousMiddlePositionX(),this.getPreviousMiddlePositionY(),this.getNextPositionX(),this.getNextPositionY(),this.getPlayer().getColor()),this.getOptions().holeCountDown--},Kurve.Curve.prototype.moveToNextFrame=function(){this.computeNewAngle();var t=this.getMovedPositionY(this.getOptions().stepLength/2),e=this.getMovedPositionX(this.getOptions().stepLength/2),i=this.getMovedPositionY(this.getOptions().stepLength),o=this.getMovedPositionX(this.getOptions().stepLength);(null===this.getPreviousMiddlePointY()||null===this.getPreviousMiddlePointX())&&(this.setPreviousMiddlePointY(t),this.setPreviousMiddlePointX(e)),this.setPreviousMiddlePositionY(this.getPreviousMiddlePointY()),this.setPreviousMiddlePositionX(this.getPreviousMiddlePointX()),this.setPositionY(this.getNextPositionY()),this.setPositionX(this.getNextPositionX()),this.setNextPositionY(i),this.setNextPositionX(o),this.setPreviousMiddlePointY(t),this.setPreviousMiddlePointX(e)},Kurve.Curve.prototype.getMovedPositionX=function(t){return this.getNextPositionX()+t*Math.cos(this.getOptions().angle)},Kurve.Curve.prototype.getMovedPositionY=function(t){return this.getNextPositionY()+t*Math.sin(this.getOptions().angle)},Kurve.Curve.prototype.checkForCollision=function(){if(this.useSuperpower(Kurve.Superpowerconfig.hooks.IS_COLLIDED)){var t=this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.IS_COLLIDED,this);if(t===!0)return this.die();if(t===!1)return}else if(this.hasJustStarted())return void this.setJustStarted(!1);var e=u.interpolateTwoPoints(this.getPositionX(),this.getPositionY(),this.getNextPositionX(),this.getNextPositionY()),i=!1,o=this;for(var n in e)for(var s in e[n])this.isCollided(n,s)&&(i=!0),Kurve.Config.Debug.curveTrace&&(o.getField().ctx.globalAlpha=.5,o.getField().ctx.fillStyle="#000",o.getField().ctx.fillRect(n,s,1,1));i&&this.die()},Kurve.Curve.prototype.isCollided=function(t,e){return this.getField().isPointOutOfBounds(t,e)?!0:this.getField().isPointDrawn(t,e)?this.getField().isPointDrawnInColor(t,e,this.getPlayer().getColor())?!this.isPointInImmediateTrace(t,e):!0:!1},Kurve.Curve.prototype.isPointInImmediateTrace=function(t,e){var i=new Date,o=this.getField().getDrawnPoint(t,e);return i.getTime()-o.time.getTime()<this.getOptions().selfCollisionTimeout?!0:!1},Kurve.Curve.prototype.die=function(){this.getGame().notifyDeath(this)},Kurve.Curve.prototype.computeNewAngle=function(){this.getGame().isKeyDown(this.getPlayer().getKeyRight())?this.incrementAngle():this.getGame().isKeyDown(this.getPlayer().getKeyLeft())&&this.decrementAngle()},Kurve.Curve.prototype.setRandomAngle=function(){this.setAngle(2*Math.PI*Math.random())},Kurve.Curve.prototype.useSuperpower=function(t){return this.getPlayer().getSuperpower().usesHook(t)?this.getPlayer().getSuperpower().isActive()?!0:Kurve.Game.isKeyDown(this.getPlayer().getKeySuperpower())&&this.getPlayer().getSuperpower().getCount()>0?!0:!1:!1},Kurve.Curve.prototype.resetHoleCountDown=function(){this.getOptions().holeCountDown=this.getOptions().holeInterval};"use strict";Kurve.Point=function(t,o){this.getPosX=function(o){return void 0===o?t:u.round(t,o)},this.getPosY=function(t){return void 0===t?o:u.round(o,t)}},Kurve.Point.prototype.equals=function(t){return t.getPosX(0)===this.getPosX(0)&&t.getPosY(0)===this.getPosY(0)},Kurve.Point.prototype.clone=function(){return new Kurve.Point(this.getPosX(),this.getPosY())};"use strict";Kurve.Player=function(e,t,r,i,s){var o=0,n=Kurve.Factory.getSuperpower(Kurve.Superpowerconfig.types.RUN_FASTER),u=null,h=!1;this.incrementPoints=function(){o++},this.setSuperpower=function(e){n=e,null===u&&(u=document.getElementById(this.getId()+"-superpower")),u.innerHTML=this.getSuperpower().getLabel()},this.setColor=function(e){t=e},this.setIsActive=function(e){h=e},this.getPoints=function(){return o},this.getId=function(){return e},this.getColor=function(){return t},this.getSuperpower=function(){return n},this.getKeyLeft=function(){return r},this.getKeyRight=function(){return i},this.getKeySuperpower=function(){return s},this.isActive=function(){return h}},Kurve.Player.prototype.renderMenuItem=function(){return'<div id="'+this.getId()+'" class="player inactive '+this.getId()+'"><div class="title light"><h2>'+this.getId()+'</h2></div><div class="key left light"><div>'+this.getKeyLeftChar()+'</div></div><div class="key right light"><div>'+this.getKeyRightChar()+'</div></div><div class="superpower"><div class="key light">'+this.getKeySuperpowerChar()+'</div><div class="superpowerType light"><div class="left" onclick="Kurve.Menu.onPreviousSuperPowerClicked(event, \''+this.getId()+'\')"></div><div class="superpowers"><div id="'+this.getId()+'-superpower">'+this.getSuperpower().getLabel()+'</div></div> <div class="right" onclick="Kurve.Menu.onNextSuperPowerClicked(event, \''+this.getId()+'\')"></div></div> </div><div class="clear"></div></div>'},Kurve.Player.prototype.renderScoreItem=function(){return'<div class="active '+this.getId()+'"><div class="title"><h2>'+this.getId()+'</h2></div><div class="points">'+this.getPoints()+'</div><div class="clear"></div><div class="superpowers">'+this.renderNumberOfSuperPowers()+'</div><div class="clear"></div></div>'},Kurve.Player.prototype.renderNumberOfSuperPowers=function(){for(var e="",t=0;t<this.getSuperpower().getCount();t++)e+='<div class="superpowerCircle '+this.getId()+'"></div>';return e},Kurve.Player.prototype.isKeyRight=function(e){return this.getKeyRight()===e},Kurve.Player.prototype.isKeyLeft=function(e){return this.getKeyLeft()===e},Kurve.Player.prototype.isKeySuperpower=function(e){return this.getKeySuperpower()===e},Kurve.Player.prototype.getKeyLeftChar=function(){return this.isArrowKey(this.getKeyLeft())?this.arrowKeyChar(this.getKeyLeft()):String.fromCharCode(this.getKeyLeft())},Kurve.Player.prototype.getKeyRightChar=function(){return this.isArrowKey(this.getKeyRight())?this.arrowKeyChar(this.getKeyRight()):String.fromCharCode(this.getKeyRight())},Kurve.Player.prototype.getKeySuperpowerChar=function(){return this.isArrowKey(this.getKeySuperpower())?this.arrowKeyChar(this.getKeySuperpower()):String.fromCharCode(this.getKeySuperpower())},Kurve.Player.prototype.isArrowKey=function(e){return 37===e||39===e||40===e},Kurve.Player.prototype.arrowKeyChar=function(e){switch(e){case 37:return'<span class="arrow arrow-left"></span>';case 39:return'<span class="arrow arrow-right"></span>';case 40:return'<span class="arrow arrow-down"></span>';default:return""}};"use strict";Kurve.Lightbox={lightboxOverlay:null,lightboxContent:null,init:function(){this.lightboxOverlay=document.getElementById("lightbox-overlay"),this.lightboxContent=document.getElementById("lightbox-content")},show:function(t){u.removeClass("hidden","lightbox-overlay"),this.lightboxContent.innerHTML=t},hide:function(){u.setClassName("hidden","lightbox-overlay"),this.lightboxContent.innerHTML=""}};"use strict";Kurve.Piwik={trackPageVariable:function(a,e){_paq.push(["setCustomVariable",1,a,e,"page"]),_paq.push(["trackPageView"])},trackPageView:function(){}};