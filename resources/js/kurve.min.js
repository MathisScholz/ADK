/**
 * @license
 *
 * Program:     Kurve
 * Author:      Markus Mächler, marmaechler@gmail.com
 * License:     http://www.gnu.org/licenses/gpl.txt
 * Link:        http://achtungkurve.com
 *
 * Copyright © 2014 Markus Mächler
 *
 * Kurve is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Kurve is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Kurve.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
"use strict";window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;"use strict";var Kurve={players:[],playersById:{},init:function(){this.initPlayers(),this.Field.init(),this.Menu.init(),this.Game.init(),this.Lightbox.init()},initPlayers:function(){Kurve.Config.players.forEach(function(e){var e=new Kurve.Player(e.id,e.color,e.keyLeft,e.keyRight,e.keySuperpower);Kurve.players.push(e),Kurve.playersById[e.getId()]=e})},getPlayer:function(e){return this.playersById[e]}};document.addEventListener("DOMContentLoaded",Kurve.init.bind(Kurve));"use strict";Kurve.Factory={getSuperpower:function(e){if(!Kurve.Superpowerconfig.hasOwnProperty(e))throw"Superpower type "+e+" is not yet registered.";var r=Kurve.Superpowerconfig[e].hooks,o=Kurve.Superpowerconfig[e].act,p=Kurve.Superpowerconfig[e].helpers,u=Kurve.Superpowerconfig[e].init,t=Kurve.Superpowerconfig[e].close,i=new Kurve.Superpower(r,o,p,e,u,t);return i}};"use strict";Kurve.Config={Debug:{curvePosition:!1,curveTrace:!1,fieldDrawnPixels:!1},Field:{defaultColor:"#333",defaultLineWidth:4,borderColor:"#ACAC9D",width:.7},Curve:{stepLength:3,lineWidth:4,dAngle:.08,holeInterval:150,selfCollisionTimeout:200},Game:{startDelay:2e3,fps:25},Utility:{interpolatedPixelsPrecision:100},players:[{id:"red",color:"#D4373E",keyLeft:49,keyRight:81,keySuperpower:65},{id:"orange",color:"#FFA039",keyLeft:37,keyRight:40,keySuperpower:39},{id:"green",color:"#3BCB69",keyLeft:89,keyRight:88,keySuperpower:67},{id:"blue",color:"#3B90C3",keyLeft:66,keyRight:78,keySuperpower:77},{id:"purple",color:"#7D11CD",keyLeft:76,keyRight:79,keySuperpower:80},{id:"pink",color:"#DC72FF",keyLeft:53,keyRight:54,keySuperpower:55}]};"use strict";Kurve.Utility=function(t){return new Kurve.Utility.Element(t)},Kurve.Utility.Element=function(t){this.element=t},Kurve.Utility.round=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},Kurve.Utility.addClass=function(t,e){var n=document.getElementById(e);return null===n?!1:void(n.className+=" "+t)},Kurve.Utility.removeClass=function(t,e){var n=document.getElementById(e);if(null===n)return!1;var r=new RegExp("(^|\\s)"+t+"($|\\s)","g");n.className=n.className.replace(r," ")},Kurve.Utility.setClassName=function(t,e){var n=document.getElementById(e);return null===n?!1:void(n.className=t)},Kurve.Utility.hasClass=function(t,e){var n=document.getElementById(e);if(null===n)return!1;var r=new RegExp("(^|\\s)"+t+"($|\\s)","g");return r.test(n.className)},Kurve.Utility.interpolateTwoPoints=function(t,e){for(var n=[],r=[],i=Kurve.Config.Utility.interpolatedPixelsPrecision,s=e.getPosX()-t.getPosX(),l=e.getPosY()-t.getPosY(),o=l/s,a=e.getPosY()-o*e.getPosX(),v=u.round(Math.abs(s)*i,0),c=1>v?1:v,g=0;c>g;g++){var m=s>0?g/i:-(g/i),d=t.getPosX()+m,y=o*d+a,P=new Kurve.Point(d,y),f=P.getPosX(0),K=P.getPosY(0);void 0===r[f]&&(r[f]=[]),r[f][K]!==!0&&(r[f][K]=!0,n.push(P))}return n};var u=Kurve.Utility;"use strict";Kurve.Menu={boundOnKeyDown:null,init:function(){this.initPlayerMenu(),this.addWindowListeners(),this.addMouseListeners()},initPlayerMenu:function(){var e="";Kurve.players.forEach(function(r){e+=r.renderMenuItem()}),document.getElementById("menu-players-list").innerHTML+=e},addWindowListeners:function(){this.boundOnKeyDown=this.onKeyDown.bind(this),window.addEventListener("keydown",this.boundOnKeyDown,!1)},addMouseListeners:function(){for(var e=document.getElementById("menu-players-list").children,r=0;r<e.length;r++)e[r].addEventListener("click",this.onPlayerItemClicked,!1)},removeWindowListeners:function(){window.removeEventListener("keydown",this.boundOnKeyDown,!1)},onPlayerItemClicked:function(){Kurve.Menu.togglePlayerActivation(this.id)},onKeyDown:function(e){32===e.keyCode&&Kurve.Menu.onSpaceDown(),Kurve.players.forEach(function(r){r.isKeyLeft(e.keyCode)?Kurve.Menu.activatePlayer(r.getId()):r.isKeyRight(e.keyCode)?Kurve.Menu.deactivatePlayer(r.getId()):r.isKeySuperpower(e.keyCode)&&Kurve.Menu.nextSuperpower(r.getId())})},onSpaceDown:function(){return Kurve.players.forEach(function(e){e.isActive&&Kurve.Game.curves.push(new Kurve.Curve(e,Kurve.Game,Kurve.Field,Kurve.Config.Curve))}),Kurve.Game.curves.length<=1?void(Kurve.Game.curves=[]):(u.addClass("hidden","layer-menu"),u.removeClass("hidden","layer-game"),void Kurve.Game.startGame())},onNextSuperPowerClicked:function(e,r){e.stopPropagation(),Kurve.Menu.nextSuperpower(r)},onPreviousSuperPowerClicked:function(e,r){e.stopPropagation(),Kurve.Menu.previousSuperpower(r)},nextSuperpower:function(e){var r=Kurve.getPlayer(e),n=0,t="";for(var u in Kurve.Superpowerconfig.types)if(n++,Kurve.Superpowerconfig.types[u]===r.getSuperpower().getType()){t=Object.keys(Kurve.Superpowerconfig.types).length===n?Object.keys(Kurve.Superpowerconfig.types)[0]:Object.keys(Kurve.Superpowerconfig.types)[n];break}r.setSuperpower(Kurve.Factory.getSuperpower(t))},previousSuperpower:function(e){var r=Kurve.getPlayer(e),n=0,t="";for(var u in Kurve.Superpowerconfig.types)if(n++,Kurve.Superpowerconfig.types[u]===r.getSuperpower().getType()){t=1===n?Object.keys(Kurve.Superpowerconfig.types)[Object.keys(Kurve.Superpowerconfig.types).length-1]:Object.keys(Kurve.Superpowerconfig.types)[n-2];break}r.setSuperpower(Kurve.Factory.getSuperpower(t))},activatePlayer:function(e){Kurve.getPlayer(e).isActive||(Kurve.getPlayer(e).isActive=!0,u.removeClass("inactive",e),u.addClass("active",e))},deactivatePlayer:function(e){Kurve.getPlayer(e).isActive&&(Kurve.getPlayer(e).isActive=!1,u.removeClass("active",e),u.addClass("inactive",e))},togglePlayerActivation:function(e){Kurve.getPlayer(e).isActive?Kurve.Menu.deactivatePlayer(e):Kurve.Menu.activatePlayer(e)},requestFullScreen:function(){document.body.webkitRequestFullScreen()}};"use strict";Kurve.Game={runIntervalId:null,fps:null,intervalTimeOut:null,maxPoints:null,keysDown:{},isRunning:!1,curves:[],runningCurves:{},players:[],deathMatch:!1,isPaused:!1,isRoundStarted:!1,playerScoresElement:null,init:function(){this.fps=Kurve.Config.Game.fps,this.intervalTimeOut=Math.round(1e3/this.fps),this.playerScoresElement=document.getElementById("player-scores")},run:function(){requestAnimationFrame(this.drawFrame.bind(this))},drawFrame:function(){for(var t in this.runningCurves)void 0!==this.runningCurves[t]&&this.runningCurves[t].drawNextFrame()},addWindowListeners:function(){Kurve.Menu.removeWindowListeners(),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))},onKeyDown:function(t){32===t.keyCode&&this.onSpaceDown(),this.keysDown[t.keyCode]=!0},onKeyUp:function(t){delete this.keysDown[t.keyCode]},isKeyDown:function(t){return this.keysDown[t]===!0},onSpaceDown:function(){return this.isRunning||this.isPaused?this.togglePause():this.isRoundStarted||this.deathMatch?!this.isRoundStarted&&this.deathMatch?this.startDeathMatch():void 0:this.startNewRound()},togglePause:function(){this.isPaused?(Kurve.Lightbox.hide(),this.startRun()):(this.stopRun(),Kurve.Lightbox.show("<h2>Game is paused</h2>")),this.isPaused=!this.isPaused},startGame:function(){this.maxPoints=10*(this.curves.length-1),this.addPlayers(),this.addWindowListeners(),this.renderPlayerScores(),this.startNewRound.bind(this)},renderPlayerScores:function(){var t="";this.players.sort(this.playerSorting),this.players.forEach(function(e){t+=e.renderScoreItem()}),this.playerScoresElement.innerHTML=t},playerSorting:function(t,e){return e.getPoints()-t.getPoints()},addPlayers:function(){Kurve.Game.curves.forEach(function(t){Kurve.Game.players.push(t.getPlayer())})},notifyDeath:function(t){delete this.runningCurves[t.getPlayer().getId()],this.losers.push(t);for(var e in this.runningCurves)this.runningCurves[e].getPlayer().incrementPoints();this.renderPlayerScores(),1===Object.keys(this.runningCurves).length&&this.terminateRound()},startNewRound:function(){this.isRoundStarted=!0,this.losers=[],Kurve.Field.drawField(),this.initRun(),this.renderPlayerScores(),setTimeout(this.startRun.bind(this),Kurve.Config.Game.startDelay)},startRun:function(){this.isRunning=!0,this.runIntervalId=setInterval(this.run.bind(this),this.intervalTimeOut),this.curves.forEach(function(t){t.setJustStarted(!0)})},stopRun:function(){this.isRunning=!1,clearInterval(this.runIntervalId)},initRun:function(){this.curves.forEach(function(t){Kurve.Game.runningCurves[t.getPlayer().getId()]=t,t.setRandomPosition(Kurve.Field.getRandomPosition()),t.setRandomAngle(),t.drawCurrentPosition(Kurve.Field),t.getPlayer().getSuperpower().init(t)})},terminateRound:function(){if(this.curves.forEach(function(t){t.getPlayer().getSuperpower().close(t)}),this.deathMatch){var t=this.runningCurves[Object.keys(this.runningCurves)[0]];this.gameOver(t.getPlayer())}this.isRoundStarted=!1,this.stopRun(),this.runningCurves={},this.incrementSuperpowers(),this.checkForWinner()},incrementSuperpowers:function(){var t=this.players.length;this.players[t-1].getSuperpower().count+=2;for(var e=u.round((t-2)/2,0),n=e;n>0;n--)this.players[t-1-n].getSuperpower().count++},checkForWinner:function(){if(!this.deathMatch){var t=[];this.players.forEach(function(e){e.getPoints()>=Kurve.Game.maxPoints&&t.push(e)}),0!==t.length&&(1===t.length&&this.gameOver(t[0]),t.length>1&&this.initDeathMatch(t))}},initDeathMatch:function(t){this.deathMatch=!0,Kurve.Lightbox.show("<h1>DEATHMATCH!</h1>");var e=[];this.curves.forEach(function(n){t.forEach(function(t){n.getPlayer()===t&&(e.push(n),t.setColor("#333"))})}),this.curves=e},startDeathMatch:function(){Kurve.Lightbox.hide(),this.startNewRound()},gameOver:function(t){Kurve.Lightbox.show('<h1 class="active '+t.getId()+'">'+t.getId()+' wins!</h1><a href="/" class="button">Start new game</a>')}};"use strict";Kurve.Field={canvas:null,ctx:null,width:null,height:null,drawnPixels:[],defaultColor:null,defaultLineWidth:null,drawnPixelPrecision:null,init:function(){this.initCanvas(),this.initContext(),this.initDrawing(),this.initField()},initCanvas:function(){var t=window.innerWidth*Kurve.Config.Field.width,i=window.innerHeight;this.canvas=document.getElementById("field"),this.canvas.width=t,this.canvas.height=i,this.width=t,this.height=i},initContext:function(){this.ctx=this.canvas.getContext("2d")},initField:function(){this.drawField()},initDrawing:function(){this.defaultColor=Kurve.Config.Field.defaultColor,this.defaultLineWidth=Kurve.Config.Field.defaultLineWidth,this.drawnPixelPrecision=Kurve.Config.Field.drawnPixelPrecision},drawField:function(){this.ctx.strokeStyle=Kurve.Config.Field.borderColor,this.ctx.lineWidth=3,this.ctx.clearRect(0,0,this.width,this.height),this.ctx.rect(0,0,this.width,this.height),this.ctx.stroke(),this.drawnPixels=[]},drawLine:function(t,i,n){void 0===n&&(n=this.defaultColor),this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.lineWidth=this.defaultLineWidth,this.ctx.moveTo(t.getPosX(),t.getPosY()),this.ctx.lineTo(i.getPosX(),i.getPosY()),this.ctx.stroke(),this.addLineToDrawnPixel(t,i,n)},drawUntrackedPoint:function(t,i){void 0===i&&(i=this.defaultColor),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.getPosX(),t.getPosY(),2,0,2*Math.PI,!1),this.ctx.fill()},drawPoint:function(t,i){this.drawUntrackedPoint(t,i),this.addPointToDrawnPixel(t,i)},addLineToDrawnPixel:function(t,i,n){var e=u.interpolateTwoPoints(t,i),o=this;e.forEach(function(t){o.addPointsToDrawnPixel(o.getPointSurroundings(t),n)})},addPointsToDrawnPixel:function(t,i){t.forEach(function(t){Kurve.Field.addPointToDrawnPixel(t,i)})},addPointToDrawnPixel:function(t,i){void 0===this.drawnPixels[t.getPosX(0)]&&(this.drawnPixels[t.getPosX(0)]=[]),this.drawnPixels[t.getPosX(0)][t.getPosY(0)]={color:i,time:new Date},Kurve.Config.Debug.fieldDrawnPixels&&(this.ctx.fillStyle="#37FDFC",this.ctx.fillRect(t.getPosX(0),t.getPosY(0),1,1))},isPointOutOfBounds:function(t){return t.getPosX()<=0||t.getPosY()<=0||t.getPosX()>=this.width||t.getPosY()>=this.height},isPointDrawn:function(t){return void 0!==this.drawnPixels[t.getPosX(0)]&&void 0!==this.drawnPixels[t.getPosX(0)][t.getPosY(0)]},isPointDrawnInColor:function(t,i){return void 0!==this.drawnPixels[t.getPosX(0)]&&this.drawnPixels[t.getPosX(0)][t.getPosY(0)].color===i},getDrawnPoint:function(t){return void 0!==this.drawnPixels[t.getPosX(0)]&&void 0!==this.drawnPixels[t.getPosX(0)][t.getPosY(0)]?this.drawnPixels[t.getPosX(0)][t.getPosY(0)]:!1},getRandomPosition:function(t){void 0===t&&(t=20);var i=t+Math.round((this.width-2*t)*Math.random()),n=t+Math.round((this.height-2*t)*Math.random());return new Kurve.Point(i,n)},getPointSurroundings:function(t){var i=t.getPosX(0),n=t.getPosY(0),e=[];return e.push(new Kurve.Point(i,n)),e.push(new Kurve.Point(i+1,n)),e.push(new Kurve.Point(i+1,n-1)),e.push(new Kurve.Point(i,n-1)),e.push(new Kurve.Point(i-1,n-1)),e.push(new Kurve.Point(i-1,n)),e.push(new Kurve.Point(i-1,n+1)),e.push(new Kurve.Point(i,n+1)),e.push(new Kurve.Point(i+1,n+1)),e}};"use strict";Kurve.Superpowerconfig={},Kurve.Superpowerconfig.types={RUN_FASTER:"RUN_FASTER",RUN_SLOWER:"RUN_SLOWER",JUMP:"JUMP",INVISIBLE:"INVISIBLE",VERTICAL_BAR:"VERTICAL_BAR",CROSS_WALLS:"CROSS_WALLS",DARK_KNIGHT:"DARK_KNIGHT"},Kurve.Superpowerconfig.hooks={DRAW_NEXT_FRAME:"DRAW_NEXT_FRAME",DRAW_LINE:"DRAW_LINE",IS_COLLIDED:"IS_COLLIDED"},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.RUN_FASTER]={label:"run faster",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{executionTime:0,initAct:function(){this.decrementCount(),this.isActive=!0,this.helpers.executionTime=4*Kurve.Game.fps},closeAct:function(){this.isActive=!1}},init:function(){},act:function(e,i){this.isActive||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),i.moveToNextFrame(),i.checkForCollision(),i.drawLine(i.getField()),this.helpers.executionTime--},close:function(){this.isActive=!1}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.RUN_SLOWER]={label:"run slower",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{initialStepLength:null,executionTime:0,initAct:function(e){this.decrementCount(),this.isActive=!0,this.helpers.executionTime=4*Kurve.Game.fps,this.helpers.initialStepLength=e.getOptions().stepLength,e.getOptions().stepLength=this.helpers.initialStepLength/2},closeAct:function(e){this.isActive=!1,e.getOptions().stepLength=this.helpers.initialStepLength}},init:function(){},act:function(e,i){this.isActive||this.helpers.initAct.call(this,i),this.helpers.executionTime<1&&this.helpers.closeAct.call(this,i),this.helpers.executionTime--},close:function(e){this.isActive=!1,null!==this.helpers.initialStepLength&&(e.getOptions().stepLength=this.helpers.initialStepLength)}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.JUMP]={label:"jump",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{jumpWidth:10,timeOut:250,previousExecution:new Date},init:function(){},act:function(e,i){var t=new Date;if(t.getTime()-this.helpers.previousExecution.getTime()>this.helpers.timeOut){var s=i.getMovedPosition(i.getOptions().stepLength*this.helpers.jumpWidth);i.setNextPosition(s),i.previousMiddlePoint=s,this.helpers.previousExecution=t,this.decrementCount()}},close:function(){this.isActive=!1}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.INVISIBLE]={label:"invisible",hooks:[Kurve.Superpowerconfig.hooks.DRAW_LINE,Kurve.Superpowerconfig.hooks.IS_COLLIDED],helpers:{executionTime:0,initAct:function(){this.decrementCount(),this.isActive=!0,this.helpers.executionTime=4*Kurve.Game.fps},closeAct:function(){this.isActive=!1}},init:function(){},act:function(e,i){if(e===Kurve.Superpowerconfig.hooks.DRAW_LINE)this.isActive||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),i.invisible=!0,this.helpers.executionTime--;else if(e===Kurve.Superpowerconfig.hooks.IS_COLLIDED&&this.isActive)return!1},close:function(){this.isActive=!1}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.VERTICAL_BAR]={label:"vertical bar",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{timeOut:250,previousExecution:new Date,barWidth:40},init:function(){},act:function(e,i){var t=new Date;if(t.getTime()-this.helpers.previousExecution.getTime()>this.helpers.timeOut){var s=Math.cos(i.getOptions().angle-Math.PI/2)*this.helpers.barWidth+i.getPosition().getPosX(),o=Math.sin(i.getOptions().angle-Math.PI/2)*this.helpers.barWidth+i.getPosition().getPosY(),n=Math.cos(i.getOptions().angle+Math.PI/2)*this.helpers.barWidth+i.getPosition().getPosX(),r=Math.sin(i.getOptions().angle+Math.PI/2)*this.helpers.barWidth+i.getPosition().getPosY();Kurve.Field.drawLine(new Kurve.Point(s,o),new Kurve.Point(n,r),i.getPlayer().getColor()),this.helpers.previousExecution=t,this.decrementCount()}},close:function(){this.isActive=!1}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.CROSS_WALLS]={label:"cross walls",hooks:[Kurve.Superpowerconfig.hooks.IS_COLLIDED],helpers:{getWallCrossedPosition:function(e){var i,t=e.getNextPosition(),s=e.getField(),o=0;return t.getPosX()>s.width?(i=t.getPosX()-s.width,o=t.getPosY()):t.getPosX()<0?(i=t.getPosX()+s.width,o=t.getPosY()):t.getPosY()>s.height?(i=t.getPosX(),o=t.getPosY()-s.height):(i=t.getPosX(),o=t.getPosY()+s.height),new Kurve.Point(i,o)}},init:function(){this.isActive=!0},act:function(e,i){var t=i.getNextPosition();if(i.getField().isPointOutOfBounds(t)&&this.count>0){this.decrementCount();var s=this.helpers.getWallCrossedPosition(i);return i.setPosition(s),i.setNextPosition(s),i.previousMiddlePosition=s,i.previousMiddlePoint=s,!1}return i.getField().isPointOutOfBounds(t)||i.getField().isPointDrawn(t)},close:function(){this.isActive=!1}},Kurve.Superpowerconfig[Kurve.Superpowerconfig.types.DARK_KNIGHT]={label:"dark knight",hooks:[Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME],helpers:{executionTime:0,darkNightDivId:"dark-knight",initAct:function(){u.hasClass("hidden",this.helpers.darkNightDivId)&&(u.removeClass("hidden",this.helpers.darkNightDivId),this.decrementCount(),this.isActive=!0,this.helpers.executionTime=3*Kurve.Game.fps)},closeAct:function(){u.addClass("hidden",this.helpers.darkNightDivId),this.isActive=!1}},init:function(){},act:function(){this.isActive||this.helpers.initAct.call(this),this.helpers.executionTime<1&&this.helpers.closeAct.call(this),this.helpers.executionTime--},close:function(){this.isActive=!1,u.hasClass("hidden",this.helpers.darkNightDivId)||u.addClass("hidden",this.helpers.darkNightDivId)}};"use strict";Kurve.Superpower=function(e,t,i,n,r,s){this.count=1,this.isActive=!1,this.act=t,this.helpers=i,this.init=r,this.close=s,this.incrementCount=function(){this.count++,Kurve.Game.renderPlayerScores()},this.decrementCount=function(){this.count--,Kurve.Game.renderPlayerScores()},this.usesHook=function(t){return e.indexOf(t)>-1},this.getType=function(){return n},this.getLabel=function(){return Kurve.Superpowerconfig[this.getType()].label}};"use strict";Kurve.Curve=function(t,e,i,o,n){var s=null,r=null,u=!1;this.invisible=!1,this.previousMiddlePoint=null,this.previousMiddlePosition=null,this.selfCollisionTimeout=o.selfCollisionTimeout;var h={stepLength:o.stepLength,lineWidth:o.lineWidth,angle:0,dAngle:o.dAngle,holeInterval:o.holeInterval,holeCountDown:o.holeInterval};this.incrementAngle=function(){h.angle+=h.dAngle},this.decrementAngle=function(){h.angle-=h.dAngle},this.setPosition=function(t){s=t},this.setNextPosition=function(t){r=t},this.setRandomPosition=function(t){s=r=this.previousMiddlePosition=this.previousMiddlePoint=t},this.setAngle=function(t){h.angle=t},this.setPosition=function(t){s=t},this.setJustStarted=function(t){u=t},this.hasJustStarted=function(){return u},this.getPlayer=function(){return t},this.getGame=function(){return e},this.getField=function(){return i},this.getSuperpower=function(){return n},this.getPosition=function(){return s},this.getNextPosition=function(){return r},this.getOptions=function(){return h}},Kurve.Curve.prototype.drawNextFrame=function(){this.moveToNextFrame(),this.checkForCollision(),this.drawLine(this.getField()),this.useSuperpower(Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME)&&this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.DRAW_NEXT_FRAME,this),Kurve.Config.Debug.curvePosition&&(this.getField().ctx.fillStyle="#000",this.getField().ctx.fillRect(this.getPosition().getPosX(0),this.getPosition().getPosY(0),1,1))},Kurve.Curve.prototype.drawCurrentPosition=function(t){t.drawUntrackedPoint(this.getPosition(),this.getPlayer().getColor())},Kurve.Curve.prototype.drawLine=function(t){this.invisible=this.getOptions().holeCountDown<0,this.useSuperpower(Kurve.Superpowerconfig.hooks.DRAW_LINE)&&this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.DRAW_LINE,this),this.invisible?this.getOptions().holeCountDown<-2&&this.resetHoleCountDown():t.drawLine(this.previousMiddlePosition,this.getNextPosition(),this.getPlayer().getColor()),this.getOptions().holeCountDown--},Kurve.Curve.prototype.moveToNextFrame=function(){this.computeNewAngle();var t=this.getMovedPosition(this.getOptions().stepLength/2),e=this.getMovedPosition(this.getOptions().stepLength);null===this.previousMiddlePoint&&(this.previousMiddlePoint=t),this.previousMiddlePosition=this.previousMiddlePoint,this.setPosition(this.getNextPosition()),this.setNextPosition(e),this.previousMiddlePoint=t},Kurve.Curve.prototype.getMovedPosition=function(t){var e=this.getNextPosition().getPosX()+t*Math.cos(this.getOptions().angle),i=this.getNextPosition().getPosY()+t*Math.sin(this.getOptions().angle);return new Kurve.Point(e,i)},Kurve.Curve.prototype.checkForCollision=function(){if(this.hasJustStarted())return void this.setJustStarted(!1);var t=u.interpolateTwoPoints(this.getPosition(),this.getNextPosition()),e=!1,i=this;t.forEach(function(t){i.isCollided(t)&&(e=!0),Kurve.Config.Debug.curveTrace&&(i.getField().ctx.globalAlpha=.5,i.getField().ctx.fillStyle="#000",i.getField().ctx.fillRect(t.getPosX(0),t.getPosY(0),1,1))}),e&&this.die()},Kurve.Curve.prototype.isCollided=function(t){return this.useSuperpower(Kurve.Superpowerconfig.hooks.IS_COLLIDED)?this.getPlayer().getSuperpower().act(Kurve.Superpowerconfig.hooks.IS_COLLIDED,this):this.getField().isPointOutOfBounds(t)?!0:this.getField().isPointDrawn(t)?this.getField().isPointDrawnInColor(t,this.getPlayer().getColor())?!this.isPointInImmediateTrace(t):!0:!1},Kurve.Curve.prototype.isPointInImmediateTrace=function(t){var e=new Date,i=this.getField().getDrawnPoint(t);return e.getTime()-i.time.getTime()<this.selfCollisionTimeout?!0:!1},Kurve.Curve.prototype.die=function(){this.getGame().notifyDeath(this)},Kurve.Curve.prototype.computeNewAngle=function(){this.getGame().isKeyDown(this.getPlayer().getKeyRight())?this.incrementAngle():this.getGame().isKeyDown(this.getPlayer().getKeyLeft())&&this.decrementAngle()},Kurve.Curve.prototype.setRandomAngle=function(){this.setAngle(2*Math.PI*Math.random())},Kurve.Curve.prototype.useSuperpower=function(t){return this.getPlayer().getSuperpower().usesHook(t)?this.getPlayer().getSuperpower().isActive?!0:Kurve.Game.isKeyDown(this.getPlayer().getKeySuperpower())&&this.getPlayer().getSuperpower().count>0?!0:!1:!1},Kurve.Curve.prototype.resetHoleCountDown=function(){this.getOptions().holeCountDown=this.getOptions().holeInterval};"use strict";Kurve.Point=function(t,o){this.getPosX=function(o){return void 0===o?t:u.round(t,o)},this.getPosY=function(t){return void 0===t?o:u.round(o,t)}},Kurve.Point.prototype.equals=function(t){return t.getPosX(0)===this.getPosX(0)&&t.getPosY(0)===this.getPosY(0)},Kurve.Point.prototype.clone=function(){return new Kurve.Point(this.getPosX(),this.getPosY())};"use strict";Kurve.Player=function(e,t,r,i,s){var o=0,n=Kurve.Factory.getSuperpower(Kurve.Superpowerconfig.types.RUN_FASTER),u=null;this.isActive=!1,this.incrementPoints=function(){o++},this.setSuperpower=function(e){n=e,null===u&&(u=document.getElementById(this.getId()+"-superpower")),u.innerHTML=this.getSuperpower().getLabel()},this.setColor=function(e){t=e},this.getPoints=function(){return o},this.getId=function(){return e},this.getColor=function(){return t},this.getSuperpower=function(){return n},this.getKeyLeft=function(){return r},this.getKeyRight=function(){return i},this.getKeySuperpower=function(){return s}},Kurve.Player.prototype.renderMenuItem=function(){return'<div id="'+this.getId()+'" class="player inactive '+this.getId()+'"><div class="title light"><h2>'+this.getId()+'</h2></div><div class="key left light"><div>'+this.getKeyLeftChar()+'</div></div><div class="key right light"><div>'+this.getKeyRightChar()+'</div></div><div class="superpower"><div class="key light">'+this.getKeySuperpowerChar()+'</div><div class="superpowerType light"><div class="left" onclick="Kurve.Menu.onPreviousSuperPowerClicked(event, \''+this.getId()+'\')"></div><div class="superpowers"><div id="'+this.getId()+'-superpower">'+this.getSuperpower().getLabel()+'</div></div> <div class="right" onclick="Kurve.Menu.onNextSuperPowerClicked(event, \''+this.getId()+'\')"></div></div> </div><div class="clear"></div></div>'},Kurve.Player.prototype.renderScoreItem=function(){return'<div class="active '+this.getId()+'"><div class="title"><h2>'+this.getId()+'</h2></div><div class="points">'+this.getPoints()+'</div><div class="clear"></div><div class="superpowers">'+this.renderNumberOfSuperPowers()+'</div><div class="clear"></div></div>'},Kurve.Player.prototype.renderNumberOfSuperPowers=function(){for(var e="",t=0;t<this.getSuperpower().count;t++)e+='<div class="superpowerCircle '+this.getId()+'"></div>';return e},Kurve.Player.prototype.isKeyRight=function(e){return this.getKeyRight()===e},Kurve.Player.prototype.isKeyLeft=function(e){return this.getKeyLeft()===e},Kurve.Player.prototype.isKeySuperpower=function(e){return this.getKeySuperpower()===e},Kurve.Player.prototype.getKeyLeftChar=function(){return this.isArrowKey(this.getKeyLeft())?this.arrowKeyChar(this.getKeyLeft()):String.fromCharCode(this.getKeyLeft())},Kurve.Player.prototype.getKeyRightChar=function(){return this.isArrowKey(this.getKeyRight())?this.arrowKeyChar(this.getKeyRight()):String.fromCharCode(this.getKeyRight())},Kurve.Player.prototype.getKeySuperpowerChar=function(){return this.isArrowKey(this.getKeySuperpower())?this.arrowKeyChar(this.getKeySuperpower()):String.fromCharCode(this.getKeySuperpower())},Kurve.Player.prototype.isArrowKey=function(e){return 37===e||39===e||40===e},Kurve.Player.prototype.arrowKeyChar=function(e){switch(e){case 37:return'<span class="arrow arrow-left"></span>';case 39:return'<span class="arrow arrow-right"></span>';case 40:return'<span class="arrow arrow-down"></span>';default:return""}};"use strict";Kurve.Lightbox={lightboxOverlay:null,lightboxContent:null,init:function(){this.lightboxOverlay=document.getElementById("lightbox-overlay"),this.lightboxContent=document.getElementById("lightbox-content")},show:function(t){u.removeClass("hidden","lightbox-overlay"),this.lightboxContent.innerHTML=t},hide:function(){u.setClassName("hidden","lightbox-overlay"),this.lightboxContent.innerHTML=""}};